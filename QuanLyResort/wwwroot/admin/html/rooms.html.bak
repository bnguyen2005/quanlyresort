<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Danh sách phòng — QuanLyResort</title>

  <!--
    Hướng tiếp cận:
    - Giữ đơn giản (HTML/CSS/vanilla JS) theo .cursorrules.
    - Có chú thích cho từng khối để dễ hiểu cho người chưa lập trình.
    - Giao diện tinh giản, trắng/phối xám, bo góc, font hệ thống (Apple-like).
    - Không chèn dữ liệu vào innerHTML để giảm XSS; chỉ dùng textContent và tạo phần tử.
  -->

  <style>
    /* Thiết kế tinh giản, giống Apple: nhiều khoảng trắng, bo góc, shadow nhẹ */
    :root{
      --bg:#f7f8fa; --card:#ffffff; --muted:#7a7f86; --accent:#007aff;
      --radius:12px; --gap:18px; --maxw:1100px;
    }
    html,body{height:100%;margin:0;font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); color:#111;}
    .wrap{max-width:var(--maxw);margin:28px auto;padding:20px;}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px;}
    .brand {display:flex;align-items:center;gap:12px;}
    .logo{width:44px;height:44px;background:linear-gradient(135deg,#fff,#f0f3ff);display:flex;align-items:center;justify-content:center;border-radius:10px;box-shadow:0 4px 14px rgba(0,0,0,0.06);}
    h1{font-size:20px;margin:0;}
    .controls{margin-left:auto;display:flex;gap:10px;align-items:center;}
    .search, .select {padding:8px 12px;border-radius:10px;border:1px solid #e6e9ee;background:#fff;}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:var(--gap);margin-top:18px;}
    .card{background:var(--card);border-radius:var(--radius);padding:14px;box-shadow:0 6px 18px rgba(17,17,17,0.06);display:flex;flex-direction:column;gap:8px;}
    .card .top{display:flex;gap:12px;align-items:center;}
    .room-thumb{width:72px;height:56px;border-radius:8px;background:linear-gradient(135deg,#f0f4ff,#fff);display:flex;align-items:center;justify-content:center;color:var(--muted);font-weight:600;}
    .meta{font-size:13px;color:var(--muted);}
    .price{font-weight:700;color:#111;}
    .status{padding:6px 8px;border-radius:999px;font-size:12px;font-weight:600;}
    .status.available{background:#eafff5;color:#006e3b;}
    .status.occupied{background:#fff2f0;color:#b22222;}
    .status.maintenance{background:#fff7e6;color:#b36b00;}
    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:8px;}
    .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:10px;border:0;cursor:pointer;}
    .muted{color:var(--muted);font-size:13px}
    .center{display:flex;align-items:center;justify-content:center;padding:36px;color:var(--muted);}
    nav.pager{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:18px;}
    nav.pager button{padding:8px 12px;border-radius:8px;border:1px solid #e6e9ee;background:#fff;cursor:pointer;}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
  </style>
</head>
<body>
  <main class="wrap" role="main">
    <header>
      <div class="brand" aria-hidden="true">
        <div class="logo" id="logo-svg">
          <!-- simple SVG room icon -->
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <rect x="3" y="6" width="18" height="12" rx="2" stroke="#007aff" stroke-width="1.6" fill="none"/>
            <rect x="6" y="9" width="4" height="3" rx="1" fill="#007aff"/>
            <rect x="14" y="9" width="4" height="3" rx="1" fill="#007aff"/>
          </svg>
        </div>
        <div>
          <h1>Danh sách phòng</h1>
          <div class="muted">Xem và lọc phòng sẵn có</div>
        </div>
      </div>

      <div class="controls" role="region" aria-label="Bộ lọc phòng">
        <input id="q" class="search" type="search" placeholder="Tìm theo số phòng, mô tả..." aria-label="Tìm phòng"/>
        <select id="statusFilter" class="select" aria-label="Lọc trạng thái">
          <option value="">Tất cả trạng thái</option>
          <option value="available">Sẵn sàng</option>
          <option value="occupied">Đang dùng</option>
          <option value="maintenance">Bảo trì</option>
        </select>
        <button id="reload" class="btn" title="Tải lại danh sách">Tải lại</button>
      </div>
    </header>

    <section id="content" aria-live="polite">
      <div id="loading" class="center">Đang tải dữ liệu...</div>
      <div id="empty" class="center" hidden>Không có phòng phù hợp.</div>
      <div id="grid" class="grid" hidden aria-label="Danh sách phòng"></div>

      <nav class="pager" id="pager" aria-label="Điều hướng trang" hidden>
        <button id="prev">‹ Trước</button>
        <div id="pageInfo" class="muted">Trang 1</div>
        <button id="next">Tiếp ›</button>
      </nav>
    </section>
  </main>

  <script>
  const API_ROOMS = location.origin + '/api/rooms'; // an toàn: cùng origin/port trang hiện tại
  // nếu dùng login API khác:
  const API_CUSTOMER_LOGIN = location.origin + '/api/auth/customer-login';

  async function loadRooms(){
    const loadingEl = document.getElementById('loading');
    try {
      loadingEl.hidden = false;
      const resp = await fetch(API_ROOMS, { method: 'GET', cache: 'no-store', credentials: 'include' });
      console.debug('[rooms] fetch', API_ROOMS, 'status', resp.status);
      if (!resp.ok) {
        const txt = await resp.text().catch(()=>null);
        console.error('rooms API error', resp.status, txt);
        throw new Error('API lỗi: ' + resp.status);
      }
      const data = await resp.json();
      rooms = Array.isArray(data) ? data : (data.items || []);
      applyFilters();
    } catch (err) {
      console.error('Lỗi khi tải rooms:', err);
      loadingEl.textContent = 'Không thể tải dữ liệu phòng. Mở DevTools -> Network để xem chi tiết.';
      // hiển thị toast/alert nếu cần
    } finally {
      loadingEl.hidden = true;
    }
  }
  </script>
</body>
</html>


<!DOCTYPE html>
<html lang="vi" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path="../assets/" data-template="vertical-menu-template-free">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
  <title>Chi ti·∫øt Kh√°ch h√†ng - Resort Management</title>
  
  <!-- NO CACHE -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  
  <link rel="icon" type="image/x-icon" href="../assets/img/favicon/favicon.ico" />
  <link rel="stylesheet" href="../assets/vendor/fonts/boxicons.css" />
  <link rel="stylesheet" href="../assets/vendor/css/core.css" class="template-customizer-core-css" />
  <link rel="stylesheet" href="../assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
  <link rel="stylesheet" href="../assets/css/demo.css" />
  <link rel="stylesheet" href="../assets/css/fix-scrollbar.css" />
  <link rel="stylesheet" href="../assets/css/admin-custom-theme.css" />
  <link rel="stylesheet" href="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
  <script src="../assets/vendor/js/helpers.js"></script>
</head>

<body>
  <div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
      
      <!-- Menu - Load from common component -->
      <div id="common-menu"></div>
      <script>
        (function() {
          const menuVersion = Date.now();
          fetch('layout-menu.html?v=' + menuVersion)
            .then(response => {
              if (!response.ok) throw new Error('Failed to load menu: ' + response.status);
              return response.text();
            })
            .then(html => {
              const menuContainer = document.getElementById('common-menu');
              if (menuContainer) {
                menuContainer.innerHTML = html;
                console.log('‚úÖ Menu loaded successfully');
              }
            })
            .catch(error => console.error('‚ùå Error loading menu:', error));
        })();
      </script>

      <!-- Layout container -->
      <div class="layout-page">
        
        <!-- Navbar -->
        <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme" id="layout-navbar">
          <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
            <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
              <i class="bx bx-menu bx-sm"></i>
            </a>
          </div>

          <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
            <div class="navbar-nav align-items-center">
              <div class="nav-item d-flex align-items-center">
                <h4 class="mb-0">üë§ Chi ti·∫øt Kh√°ch h√†ng</h4>
              </div>
            </div>

            <ul class="navbar-nav flex-row align-items-center ms-auto">
              <li class="nav-item navbar-dropdown dropdown-user dropdown">
                <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
                  <div class="avatar avatar-online">
                    <img src="../assets/img/avatars/1.png" alt class="w-px-40 h-auto rounded-circle" />
                  </div>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li>
                    <a class="dropdown-item" href="#">
                      <div class="d-flex">
                        <div class="flex-shrink-0 me-3">
                          <div class="avatar avatar-online">
                            <img src="../assets/img/avatars/1.png" alt class="w-px-40 h-auto rounded-circle" />
                          </div>
                        </div>
                        <div class="flex-grow-1">
                          <span class="fw-semibold d-block" id="userFullName">Admin</span>
                          <small class="text-muted" id="userRole">Admin</small>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li><div class="dropdown-divider"></div></li>
                  <li><a class="dropdown-item" href="#" onclick="commonLogout()"><i class="bx bx-power-off me-2"></i><span class="align-middle">ƒêƒÉng xu·∫•t</span></a></li>
                </ul>
              </li>
            </ul>
          </div>
        </nav>

        <!-- Content wrapper -->
        <div class="content-wrapper">
          <div class="container-xxl flex-grow-1 container-p-y">
            
            <!-- Back button -->
            <div class="mb-4">
              <a href="customers.html" class="btn btn-outline-secondary">
                <i class="bx bx-arrow-back me-1"></i> Quay l·∫°i danh s√°ch
              </a>
            </div>

            <!-- Customer Details Card -->
            <div class="card" id="customerDetailsCard">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Th√¥ng tin Kh√°ch h√†ng</h5>
                <div>
                  <button class="btn btn-primary btn-sm" onclick="editCustomer()">
                    <i class="bx bx-edit me-1"></i> Ch·ªânh s·ª≠a
                  </button>
                </div>
              </div>
              <div class="card-body">
                <div id="customerDetailsContent">
                  <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">ƒêang t·∫£i...</span>
                    </div>
                    <p class="mt-3 text-muted">ƒêang t·∫£i th√¥ng tin kh√°ch h√†ng...</p>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Core JS -->
  <script src="../assets/vendor/libs/jquery/jquery.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
  <script src="../assets/vendor/js/menu.js"></script>
  <script src="../assets/js/main.js"></script>
  <script src="../js/api.js"></script>
  <script src="../js/common-navbar.js"></script>

  <script>
    // L·∫•y customerId t·ª´ URL
    const urlParams = new URLSearchParams(window.location.search);
    const customerId = urlParams.get('id');

    if (!customerId) {
      document.getElementById('customerDetailsContent').innerHTML = `
        <div class="alert alert-danger">
          <i class="bx bx-error-circle me-2"></i> Kh√¥ng t√¨m th·∫•y ID kh√°ch h√†ng. Vui l√≤ng quay l·∫°i danh s√°ch.
        </div>
      `;
    } else {
      loadCustomerDetails(customerId);
    }

    async function loadCustomerDetails(id) {
      try {
        const response = await apiGet(`/customermanagement/${id}`);
        if (response.ok) {
          const customer = await response.json();
          displayCustomerDetails(customer);
        } else {
          document.getElementById('customerDetailsContent').innerHTML = `
            <div class="alert alert-danger">
              <i class="bx bx-error-circle me-2"></i> Kh√¥ng th·ªÉ t·∫£i th√¥ng tin kh√°ch h√†ng. Vui l√≤ng th·ª≠ l·∫°i.
            </div>
          `;
        }
      } catch (error) {
        console.error('‚ùå Error loading customer details:', error);
        document.getElementById('customerDetailsContent').innerHTML = `
          <div class="alert alert-danger">
            <i class="bx bx-error-circle me-2"></i> C√≥ l·ªói x·∫£y ra khi t·∫£i th√¥ng tin kh√°ch h√†ng.
          </div>
        `;
      }
    }

    function displayCustomerDetails(customer) {
      const formatDate = (dateString) => {
        if (!dateString) return '-';
        return new Date(dateString).toLocaleDateString('vi-VN');
      };

      const getCustomerTypeText = (type) => {
        switch (type) {
          case 'Individual': return 'C√° nh√¢n';
          case 'Corporate': return 'Doanh nghi·ªáp';
          case 'Group': return 'Nh√≥m';
          default: return type;
        }
      };

      const getVipLevelBadge = (level) => {
        const colors = {
          'Bronze': 'warning',
          'Silver': 'secondary',
          'Gold': 'warning',
          'Platinum': 'info'
        };
        const color = colors[level] || 'secondary';
        return `<span class="badge bg-${color}">${level}</span>`;
      };

      const html = `
        <div class="row">
          <div class="col-md-6 mb-4">
            <div class="card border">
              <div class="card-header bg-light">
                <h6 class="mb-0"><i class="bx bx-user me-2"></i> Th√¥ng tin c∆° b·∫£n</h6>
              </div>
              <div class="card-body">
                <table class="table table-borderless">
                  <tr>
                    <td width="40%"><strong>H·ªç t√™n:</strong></td>
                    <td>${customer.fullName || '-'}</td>
                  </tr>
                  <tr>
                    <td><strong>Email:</strong></td>
                    <td>${customer.email || '-'}</td>
                  </tr>
                  <tr>
                    <td><strong>S·ªë ƒëi·ªán tho·∫°i:</strong></td>
                    <td>${customer.phoneNumber || '-'}</td>
                  </tr>
                  <tr>
                    <td><strong>Ng√†y sinh:</strong></td>
                    <td>${formatDate(customer.dateOfBirth)}</td>
                  </tr>
                  <tr>
                    <td><strong>Gi·ªõi t√≠nh:</strong></td>
                    <td>${customer.gender || '-'}</td>
                  </tr>
                  <tr>
                    <td><strong>Qu·ªëc t·ªãch:</strong></td>
                    <td>${customer.nationality || '-'}</td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
          
          <div class="col-md-6 mb-4">
            <div class="card border">
              <div class="card-header bg-light">
                <h6 class="mb-0"><i class="bx bx-info-circle me-2"></i> Th√¥ng tin b·ªï sung</h6>
              </div>
              <div class="card-body">
                <table class="table table-borderless">
                  <tr>
                    <td width="40%"><strong>Lo·∫°i kh√°ch h√†ng:</strong></td>
                    <td><span class="badge bg-primary">${getCustomerTypeText(customer.customerType)}</span></td>
                  </tr>
                  <tr>
                    <td><strong>ƒê·ªãa ch·ªâ:</strong></td>
                    <td>${customer.address || '-'}</td>
                  </tr>
                  <tr>
                    <td><strong>CMND/CCCD:</strong></td>
                    <td>${customer.idCardNumber || '-'}</td>
                  </tr>
                  <tr>
                    <td><strong>Passport:</strong></td>
                    <td>${customer.passportNumber || '-'}</td>
                  </tr>
                  <tr>
                    <td><strong>ƒêi·ªÉm t√≠ch l≈©y:</strong></td>
                    <td><span class="badge bg-success">${customer.loyaltyPoints || 0} ƒëi·ªÉm</span></td>
                  </tr>
                  <tr>
                    <td><strong>C·∫•p VIP:</strong></td>
                    <td>${getVipLevelBadge(customer.vipLevel || 'Bronze')}</td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        ${customer.notes ? `
        <div class="row">
          <div class="col-12">
            <div class="card border">
              <div class="card-header bg-light">
                <h6 class="mb-0"><i class="bx bx-note me-2"></i> Ghi ch√∫</h6>
              </div>
              <div class="card-body">
                <p class="mb-0">${customer.notes}</p>
              </div>
            </div>
          </div>
        </div>
        ` : ''}
        
        <div class="row mt-3">
          <div class="col-12">
            <div class="card border">
              <div class="card-header bg-light">
                <h6 class="mb-0"><i class="bx bx-time me-2"></i> Th√¥ng tin h·ªá th·ªëng</h6>
              </div>
              <div class="card-body">
                <table class="table table-borderless">
                  <tr>
                    <td width="40%"><strong>Ng√†y t·∫°o:</strong></td>
                    <td>${formatDate(customer.createdAt)}</td>
                  </tr>
                  ${customer.updatedAt ? `
                  <tr>
                    <td><strong>Ng√†y c·∫≠p nh·∫≠t:</strong></td>
                    <td>${formatDate(customer.updatedAt)}</td>
                  </tr>
                  ` : ''}
                </table>
              </div>
            </div>
          </div>
        </div>
      `;

      document.getElementById('customerDetailsContent').innerHTML = html;
    }

    function editCustomer() {
      if (customerId) {
        window.location.href = `customers.html?edit=${customerId}`;
      }
    }
  </script>
</body>
</html>


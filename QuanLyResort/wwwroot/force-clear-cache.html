<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üßπ FORCE CLEAR ALL CACHE & RELOAD</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .warning { background: #fff3cd; padding: 20px; border-radius: 10px; margin: 20px 0; }
        .success { background: #d4edda; padding: 20px; border-radius: 10px; margin: 20px 0; }
        button { padding: 15px 30px; font-size: 18px; margin: 10px; cursor: pointer; }
        .danger { background: #dc3545; color: white; }
        .primary { background: #007bff; color: white; }
    </style>
</head>
<body>
    <h1>üßπ FORCE CLEAR ALL CACHE & RELOAD</h1>
    
    <div class="warning">
        <h2>‚ö†Ô∏è QUAN TR·ªåNG:</h2>
        <p>B·∫°n PH·∫¢I th·ª±c hi·ªán C·∫¢ 3 B∆Ø·ªöC sau theo th·ª© t·ª±:</p>
        <ol>
            <li><strong>B∆∞·ªõc 1:</strong> Click "CLEAR ALL CACHE" b√™n d∆∞·ªõi</li>
            <li><strong>B∆∞·ªõc 2:</strong> ƒê√≥ng T·∫§T C·∫¢ tab c·ªßa localhost:5130</li>
            <li><strong>B∆∞·ªõc 3:</strong> M·ªü tab m·ªõi v√† truy c·∫≠p: <code>http://localhost:5130/admin/html/rooms-new.html</code></li>
        </ol>
    </div>
    
    <button class="danger" onclick="clearAllCache()">CLEAR ALL CACHE</button>
    <button class="primary" onclick="openNewRoomsPage()">OPEN NEW ROOMS PAGE</button>
    
    <div id="result"></div>

    <script>
        async function clearAllCache() {
            const result = document.getElementById('result');
            result.innerHTML = '<h3>‚è≥ Clearing cache...</h3>';
            
            try {
                // 1. Unregister all service workers
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (const registration of registrations) {
                        await registration.unregister();
                        result.innerHTML += '<p>‚úÖ Unregistered Service Worker</p>';
                    }
                }
                
                // 2. Clear all caches
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    for (const cacheName of cacheNames) {
                        await caches.delete(cacheName);
                        result.innerHTML += '<p>‚úÖ Deleted cache: ' + cacheName + '</p>';
                    }
                }
                
                // 3. Clear localStorage
                localStorage.clear();
                result.innerHTML += '<p>‚úÖ Cleared localStorage</p>';
                
                // 4. Clear sessionStorage
                sessionStorage.clear();
                result.innerHTML += '<p>‚úÖ Cleared sessionStorage</p>';
                
                result.innerHTML += '<div class="success"><h3>‚úÖ ALL CACHE CLEARED!</h3><p>B√¢y gi·ªù h√£y:</p><ol><li>ƒê√≥ng T·∫§T C·∫¢ tab localhost:5130</li><li>M·ªü tab m·ªõi v√† click "OPEN NEW ROOMS PAGE"</li></ol></div>';
                
            } catch (error) {
                result.innerHTML += '<p>‚ùå Error: ' + error.message + '</p>';
            }
        }
        
        function openNewRoomsPage() {
            // Open new page with timestamp to ensure fresh load
            const timestamp = Date.now();
            window.open(`/admin/html/rooms-new.html?v=${timestamp}&nocache=1&force=1`, '_blank');
        }
    </script>
</body>
</html>

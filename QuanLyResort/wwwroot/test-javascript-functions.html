<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Test JavaScript Functions</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        .warning { background: #fff3cd; }
        button { padding: 10px 20px; margin: 5px; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>üîç Test JavaScript Functions</h1>
    
    <div class="test-section">
        <h3>1. Test API Functions</h3>
        <button onclick="testAPIFunctions()">Test API Functions</button>
        <div id="apiResult" class="log"></div>
    </div>
    
    <div class="test-section">
        <h3>2. Test formatCurrency Function</h3>
        <button onclick="testFormatCurrency()">Test formatCurrency</button>
        <div id="currencyResult" class="log"></div>
    </div>
    
    <div class="test-section">
        <h3>3. Test Rooms Page Functions</h3>
        <button onclick="testRoomsFunctions()">Test Rooms Functions</button>
        <div id="roomsResult" class="log"></div>
    </div>
    
    <div class="test-section">
        <h3>4. Test JavaScript Errors</h3>
        <button onclick="testJavaScriptErrors()">Test JavaScript Errors</button>
        <div id="errorResult" class="log"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js?v=20251026"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js?v=20251026"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js?v=20251026"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js?v=20251026"></script>
    <script src="../js/api.js?v=20251026"></script>
    
    <script>
        function log(elementId, message) {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            element.textContent += `[${timestamp}] ${message}\n`;
        }
        
        function testAPIFunctions() {
            log('apiResult', 'Testing API functions...');
            
            // Test if functions exist
            const functions = [
                'formatCurrency',
                'formatDate', 
                'formatDateTime',
                'getAuthHeaders',
                'apiRequest',
                'apiGet',
                'apiPost',
                'apiPut',
                'apiPatch',
                'apiDelete',
                'login',
                'logout',
                'isAuthenticated',
                'getCurrentUser',
                'hasRole'
            ];
            
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    log('apiResult', `‚úÖ ${funcName} function exists`);
                } else {
                    log('apiResult', `‚ùå ${funcName} function not found`);
                }
            });
        }
        
        function testFormatCurrency() {
            log('currencyResult', 'Testing formatCurrency function...');
            
            if (typeof formatCurrency === 'function') {
                log('currencyResult', '‚úÖ formatCurrency function exists');
                
                // Test with different values
                const testValues = [0, 100000, 500000, 1000000, null, undefined];
                
                testValues.forEach(value => {
                    try {
                        const result = formatCurrency(value);
                        log('currencyResult', `formatCurrency(${value}) = "${result}"`);
                    } catch (error) {
                        log('currencyResult', `‚ùå Error with ${value}: ${error.message}`);
                    }
                });
            } else {
                log('currencyResult', '‚ùå formatCurrency function not found');
            }
        }
        
        function testRoomsFunctions() {
            log('roomsResult', 'Testing rooms page functions...');
            
            // Test if we can access rooms page functions
            try {
                // Test if we can load rooms page
                fetch('/admin/html/rooms.html?v=20251026&nocache=1')
                    .then(response => response.text())
                    .then(html => {
                        log('roomsResult', `‚úÖ Rooms page loaded: ${html.length} characters`);
                        
                        // Check if it contains expected functions
                        if (html.includes('loadRooms')) {
                            log('roomsResult', '‚úÖ Contains loadRooms function');
                        } else {
                            log('roomsResult', '‚ùå Missing loadRooms function');
                        }
                        
                        if (html.includes('formatCurrency')) {
                            log('roomsResult', '‚ö†Ô∏è Contains formatCurrency (might be duplicate)');
                        } else {
                            log('roomsResult', '‚úÖ No duplicate formatCurrency');
                        }
                    })
                    .catch(error => {
                        log('roomsResult', `‚ùå Error loading rooms page: ${error.message}`);
                    });
            } catch (error) {
                log('roomsResult', `‚ùå Error: ${error.message}`);
            }
        }
        
        function testJavaScriptErrors() {
            log('errorResult', 'Testing JavaScript errors...');
            
            // Capture console errors
            const originalError = console.error;
            const errors = [];
            
            console.error = function(...args) {
                errors.push(args.join(' '));
                originalError.apply(console, args);
            };
            
            // Test if there are any syntax errors
            try {
                // Test if we can evaluate the rooms page script
                log('errorResult', '‚úÖ No syntax errors detected');
            } catch (error) {
                log('errorResult', `‚ùå Syntax error: ${error.message}`);
            }
            
            // Check for common errors
            if (typeof $ === 'undefined') {
                log('errorResult', '‚ùå jQuery not loaded');
            } else {
                log('errorResult', '‚úÖ jQuery loaded');
            }
            
            if (typeof $.fn.DataTable === 'undefined') {
                log('errorResult', '‚ùå DataTables not loaded');
            } else {
                log('errorResult', '‚úÖ DataTables loaded');
            }
            
            if (typeof bootstrap === 'undefined') {
                log('errorResult', '‚ùå Bootstrap not loaded');
            } else {
                log('errorResult', '‚úÖ Bootstrap loaded');
            }
            
            // Restore original console.error
            console.error = originalError;
            
            if (errors.length > 0) {
                log('errorResult', `‚ö†Ô∏è Found ${errors.length} console errors`);
                errors.forEach(error => {
                    log('errorResult', `Error: ${error}`);
                });
            } else {
                log('errorResult', '‚úÖ No console errors found');
            }
        }
        
        // Auto-run tests on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                testAPIFunctions();
                testFormatCurrency();
                testRoomsFunctions();
                testJavaScriptErrors();
            }, 1000);
        });
    </script>
</body>
</html>
